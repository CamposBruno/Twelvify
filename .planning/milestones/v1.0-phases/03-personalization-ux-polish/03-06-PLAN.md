---
phase: 03-personalization-ux-polish
plan: 06
type: execute
wave: 4
depends_on: [03-04, 03-05]
files_modified: []
autonomous: false
requirements: [PERS-01, PERS-02, PERS-03, PERS-04, SIMP-03, SIMP-04, DISP-01, DISP-02]

must_haves:
  truths:
    - "New user simplifies text immediately with no setup required (defaults apply)"
    - "FloatingButton shows age-level cycling label (e.g. 'Explain like I'm 5' when tone=12)"
    - "Ctrl+Shift+1 triggers simplification when text is selected"
    - "After simplification, button becomes green undo button; ESC key reverts"
    - "Extension popup shows all settings; changes persist after browser restart"
    - "After 3rd simplification, onboarding prompt appears below simplified text"
    - "Dismissed onboarding prompts do not reappear"
    - "Display mode toggle in popup switches between in-page and floating popup"
  artifacts:
    - path: "src/entrypoints/content.ts"
      provides: "Phase 3 content script — all features live"
    - path: "src/entrypoints/popup/App.tsx"
      provides: "Settings popup with all preferences"
    - path: "src/utils/undoStack.ts"
      provides: "Undo stack utility"
    - path: "src/utils/onboarding.ts"
      provides: "Onboarding trigger logic"
    - path: "src/components/FloatingButton.tsx"
      provides: "Multi-mode floating button"
    - path: "src/components/OnboardingPrompt.tsx"
      provides: "Inline onboarding prompt component"
    - path: "src/components/FloatingPopup.tsx"
      provides: "Popup display mode component"
  key_links:
    - from: "src/entrypoints/popup/SettingsPanel.tsx"
      to: "chrome.storage.sync"
      via: "useStorageSyncValue — changes visible across page reloads"
      pattern: "useStorageSyncValue"
    - from: "src/entrypoints/content.ts"
      to: "backend /api/simplify"
      via: "tone/depth/profession in fetch body"
      pattern: "tone.*depth.*profession"
---

<objective>
Human verification of all Phase 3 features in the live extension.

Purpose: Phase 3 introduces five interconnected user-facing features (age-level cycling, undo, keyboard shortcut, progressive onboarding, settings UI). These require manual verification in a real browser — automated tests cannot verify visual UI, keyboard interaction, or cross-tab storage sync behavior.

Output: Human-verified pass/fail on all Phase 3 success criteria.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build extension and start backend</name>
  <files></files>
  <action>
1. From `/Users/brunocampos/Twelvify`, run `npm run build` to build the extension. Fix any TypeScript or build errors before proceeding.

2. Verify the build output exists: `ls .output/chrome-mv3/` — should contain manifest.json and content scripts.

3. Start the backend (needed for actual simplification during UAT):
   ```
   cd /Users/brunocampos/Twelvify/backend && node src/server.js &
   ```
   Or per the existing local dev pattern: `npm run dev` in the backend directory.

4. Confirm backend health: `curl http://localhost:3001/health` → should return 200.
  </action>
  <verify>
`npm run build` exits with 0. `.output/chrome-mv3/manifest.json` exists. `curl http://localhost:3001/health` returns 200.
  </verify>
  <done>Extension built successfully; backend running on localhost:3001.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Human verification of all Phase 3 features</name>
  <files></files>
  <what-built>
Phase 3 complete: age-level cycling label on FloatingButton, undo stack with ESC key, Ctrl+Shift+1 keyboard shortcut, progressive onboarding prompts, SettingsPanel in extension popup, FloatingPopup display mode, chrome.storage.sync persistence.
  </what-built>
  <action>Human verifies all Phase 3 features in a live Chrome browser using the steps below.</action>
  <how-to-verify>
Load the extension: Open chrome://extensions/, enable Developer mode, Load unpacked → select `/Users/brunocampos/Twelvify/.output/chrome-mv3/`. Reload extension if already loaded.

**Test 1 — Default state (PERS-01: works out of the box)**
1. Open any webpage (e.g., https://en.wikipedia.org/wiki/Complexity)
2. Select a sentence of text
3. Verify: FloatingButton appears with label "Explain like I'm 5" (not "Simplify")
   - This confirms tone=12 default → shows one-level-lower label "5"
4. Click the button → text simplifies
5. Verify: simplified text appears in-page (replace mode default)

**Test 2 — Age-level cycling label**
1. Open extension popup (click toolbar icon)
2. In Settings, change Age Level to "Baby"
3. On a webpage, select text
4. Verify: FloatingButton label is now "Explain like I'm a Big Boy" (Baby wraps to Big Boy)
5. Change Age Level back to "12" in settings
6. Select text again
7. Verify: label returns to "Explain like I'm 5"

**Test 3 — Undo (SIMP-04)**
1. Select text and simplify it
2. Verify: FloatingButton turns GREEN and shows "↩ Undo"
3. Click the Undo button
4. Verify: original text is restored in-page; button returns to normal (indigo age-level label)
5. Simplify different text, then press ESC key
6. Verify: ESC reverts the simplification

**Test 4 — Keyboard shortcut (SIMP-03)**
1. Select some text on a webpage (do NOT click the floating button)
2. Press Ctrl+Shift+1 (Cmd+Shift+1 on Mac)
3. Verify: simplification triggers (text replaced, loading state visible)
4. Press Ctrl+Shift+1 with NO text selected
5. Verify: nothing happens (silent no-op)

**Test 5 — Progressive onboarding (PERS-02)**
Pre-condition: either use a fresh profile OR reset chrome.storage.sync via DevTools → Application → Storage → chrome.storage.sync → clear simplifyCount and dismissedOnboardingPrompts.

1. Simplify 3 pieces of text
2. Verify: after the 3rd simplification, an onboarding prompt appears inline below the simplified text asking about age level
3. Click "Not now →"
4. Verify: prompt disappears immediately
5. Simplify 3 more times (total = 6)
6. Verify: a different prompt appears (depth)
7. For the depth prompt, click an option (e.g., "Detailed")
8. Verify: popup disappears; in extension popup settings, Depth shows "Detailed"
9. Reload page, simplify text again
10. Verify: dismissed tone prompt does NOT reappear

**Test 6 — Settings persistence (PERS-04)**
1. Open extension popup, set profession to "I'm a software engineer"
2. Close popup, close browser tab, reopen a new tab
3. Open extension popup again
4. Verify: profession field still shows "I'm a software engineer" (chrome.storage.sync persisted)

**Test 7 — Display mode toggle (DISP-02)**
1. Open extension popup
2. Switch Display Mode to "Show in popup"
3. On a webpage, select text and click the floating button (or press Ctrl+Shift+1)
4. Verify: a floating card appears near the bottom-right corner showing the simplified text (NOT in-place replacement)
5. Click the × close button on the card
6. Verify: card disappears; original text remains in-page
7. Switch Display Mode back to "Replace in-page"
8. Verify: next simplification replaces text in-page again
  </how-to-verify>
  <resume-signal>Type "approved" if all 7 tests pass. Describe any failures with test number and observed behavior.</resume-signal>
  <verify>All 7 UAT test cases pass in live Chrome browser with extension loaded from .output/chrome-mv3/.</verify>
  <done>Human confirms: age-level label, undo, keyboard shortcut, onboarding prompts, settings persistence, and display mode toggle all work correctly.</done>
</task>

</tasks>

<verification>
All 7 UAT tests pass as described above. TypeScript compiles cleanly (npx tsc --noEmit). Build succeeds (npm run build).
</verification>

<success_criteria>
1. New user simplifies text on first use without configuration — extension works with sensible defaults (tone: 12, depth: medium, displayMode: replace)
2. FloatingButton shows age-level cycling label; wraps Baby → Big Boy
3. Keyboard shortcut Ctrl+Shift+1 triggers simplification when text is selected; no-op when nothing selected
4. Undo button (green) appears after simplification; click or ESC reverts text to original
5. After 3rd simplification, onboarding prompt appears; dismissal is permanent (forever)
6. All settings persist across browser restarts via chrome.storage.sync
7. Display mode toggle works: popup card appears when displayMode=popup, in-place replacement when displayMode=replace
</success_criteria>

<output>
After completion, create `.planning/phases/03-personalization-ux-polish/03-06-SUMMARY.md` following the summary template.
</output>
