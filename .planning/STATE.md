# Session State

## Project Reference

See: .planning/PROJECT.md

## Position

**Milestone:** v1.0 milestone
**Current phase:** 01-foundation-text-selection
**Current Plan:** 04 complete (awaiting human-verify checkpoint)
**Status:** In progress

## Decisions

- Used srcDir: 'src' in wxt.config.ts so WXT resolves entrypoints at src/entrypoints/ (WXT default is root/entrypoints)
- npm create wxt@latest unavailable — scaffolded project manually with identical structure to react-ts template
- Manifest config co-located in wxt.config.ts (no separate public/manifest.json needed — WXT merges at build time)
- Only 'storage' permission granted — principle of least privilege per EXTF-04
- [Phase 01-foundation-text-selection]: Used srcDir: src in wxt.config.ts so WXT resolves entrypoints at src/entrypoints
- [Phase 01-02]: Listeners at defineBackground() top level — MV3 service workers terminate/restart, async-registered listeners may not fire
- [Phase 01-02]: All state in chrome.storage.local — module-scope variables lost when service worker idles 30s
- [Phase 01-02]: useStorageValue hook uses onChanged listener for real-time popup sync
- [Phase 01-03]: Popover API (popover="manual") renders in browser top layer — zero z-index management needed
- [Phase 01-03]: Both selectionchange and mouseup events needed for keyboard and mouse drag selection coverage
- [Phase 01-03]: react-dom/client (not react/client) is the correct React 18 createRoot import path
- [Phase 01-04]: Always-render pattern — FloatingButton never returns null; CSS opacity/pointerEvents toggle eliminates showPopover race condition
- [Phase 01-04]: Storage-driven visibility — FloatingButton reads selectedText via useStorageValue; content script only dispatches messages
- [Phase 01-04]: z-index 2147483647 used instead of Popover API top-layer for button stacking

## Session Log

- 2026-02-23: STATE.md regenerated by /gsd:health --repair
- 2026-02-23: Completed 01-01 (WXT scaffold + Manifest V3 config). Tasks: 2, commits: e834ad0, 4dc9b5f
- 2026-02-23: Completed 01-02 (Service worker + chrome.storage state management). Tasks: 2, commits: 108e26b, 689493b
- 2026-02-23: Completed 01-03 (Content script + FloatingButton with Popover API). Tasks: 2, commits: f5665cd, b156473
- 2026-02-23: Completed 01-04 auto-tasks (Gap closure — FloatingButton race condition fix). Tasks: 2, commits: 39d037e, de3f6d1. Awaiting human-verify checkpoint.
