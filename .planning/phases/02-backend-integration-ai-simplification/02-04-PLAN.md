---
phase: 02-backend-integration-ai-simplification
plan: "04"
type: execute
wave: 4
depends_on:
  - "02-03"
autonomous: false
files_modified: []
requirements:
  - SIMP-02
  - BACK-01
  - BACK-02
  - ERRH-01
  - ERRH-02
  - ERRH-03
  - ERRH-04

must_haves:
  truths:
    - "User can select text on a webpage, click Simplify, and see the text replaced in-place with simplified version"
    - "Button shows spinner during AI processing and hides after completion"
    - "Error tooltip appears with yellow button + shake on each of the four error scenarios"
    - "Rate limit message includes specific reset time in minutes"
  artifacts:
    - path: "src/components/ErrorTooltip.tsx"
      provides: "Error tooltip component"
    - path: "backend/src/routes/simplify.ts"
      provides: "SSE streaming endpoint"
    - path: "src/entrypoints/content.ts"
      provides: "handleSimplify with real API call"
  key_links:
    - from: "Extension FloatingButton click"
      to: "backend /api/simplify SSE stream"
      via: "fetch + ReadableStream in content.ts handleSimplify()"
      pattern: "fetch.*simplify"
---

<objective>
Human verification that Phase 2 works end-to-end: AI simplification streams in-place, all four error scenarios show appropriate sarcastic tooltips, and the backend enforces rate limiting.

Purpose: This is the human acceptance test for Phase 2. Claude cannot verify visual UI effects, real AI output quality, or actual streaming behavior in a live browser. The human must confirm the full flow works.

Output: Human approval that Phase 2 success criteria are met, or a list of issues to fix before marking complete.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/phases/02-backend-integration-ai-simplification/02-CONTEXT.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Human Verify: End-to-end Phase 2 — streaming simplification and error handling</name>
  <action>Human tests the complete Phase 2 flow: start backend, load extension, verify streaming simplification and all four error scenarios work correctly.</action>
  <what-built>
    Phase 2 complete: Express backend with SSE streaming + OpenAI integration, extension wired with real handleSimplify(), streaming DOM replacement, client-side rate limiting, and full error handling UI (yellow button + shake + sarcastic tooltips).
  </what-built>
  <how-to-verify>
    **Before testing:**

    1. Start the backend:
       ```
       cd backend
       cp .env.example .env.local
       # Edit .env.local — set OPENAI_API_KEY to your real key
       npm install && npm run dev
       ```
       Expected: "Twelvify backend listening on port 3001"

    2. Verify backend health:
       ```
       curl http://localhost:3001/health
       ```
       Expected: `{"status":"ok","timestamp":"..."}`

    3. Build and load the extension:
       ```
       npm run build
       ```
       Then in Chrome: go to `chrome://extensions` → Load unpacked → select `.output/chrome-mv3/`

    **Core flow test:**

    4. Open any webpage (e.g., a Wikipedia article or news site)
    5. Select 2-3 sentences of text
    6. The Simplify button should appear in the bottom-right
    7. Click Simplify
       - Expected: Button shows spinner ("Simplifying...")
       - Expected: Selected text begins being replaced word-by-word with simplified text within 1-2 seconds
       - Expected: After streaming completes, a subtle indigo highlight fades on the simplified text over ~1.5 seconds
       - Expected: Button disappears (selected text cleared from storage)

    **Error scenario tests:**

    8. **Offline test** — Turn off Wi-Fi/network, then select text and click Simplify:
       - Expected: Button turns warning yellow
       - Expected: Button shakes once (brief shiver animation)
       - Expected: Dark tooltip appears above button: "Wow, no internet. Shocking."
       - Expected: Tooltip auto-dismisses after ~5 seconds
       - Expected: Clicking tooltip dismisses it immediately

    9. **Text too long test** — Open browser console and run:
       ```javascript
       // Simulate selecting very long text
       // Select 5001+ characters manually from a dense article, or use browser console to
       // inject long text and trigger selection detection
       ```
       Alternative: Select a very long passage from a dense Wikipedia article (>5000 chars)
       - Expected: Button turns yellow + shakes + tooltip: "Easy there, speed racer. That's too much to chew. Select a shorter passage (under 5000 characters)."

    10. **Rate limit test (backend)** — Test the 429 response:
        ```
        # Send 101 rapid requests to backend
        for i in $(seq 1 101); do
          curl -s -X POST http://localhost:3001/api/simplify \
            -H "Content-Type: application/json" \
            -d '{"text":"test text"}' | head -1
        done
        ```
        After 100 requests: Expected 429 response with resetAt field.
        In the extension: After hitting backend limit, expected tooltip: "Chill, I need a break. Try again in N minutes." with accurate N.

    11. **Confirm no text in logs** — Check backend console output after any simplification:
        - Expected: Log lines contain `fingerprint`, `inputLengthBin`, `durationMs` — NOT any user text content

    **Quality check:**

    12. Test simplification quality on 3 different text types:
        - Dense technical paragraph (e.g., medical/legal text)
        - Simple blog paragraph
        - Text in a non-English language (e.g., Spanish or French article)
        - Expected for each: Output is clearly simpler, same language, preserves meaning

  </how-to-verify>
  <verify>Human confirms all steps above pass — core flow, all 4 error scenarios, no text in logs, and simplification quality acceptable.</verify>
  <done>Phase 2 UAT complete: streaming works, error UI shows correct messages, logs contain no user text, quality verified across 3 text types.</done>
  <resume-signal>
    Type "approved" if all tests pass, or describe specific issues found (e.g., "streaming not working — button spins but text doesn't replace", "tooltip not appearing on offline test", "backend crashes on start").
  </resume-signal>
</task>

</tasks>

<verification>
Human-verified. See checkpoint resume signal.
</verification>

<success_criteria>
- User confirms AI simplification works end-to-end (select → click → stream → replace)
- User confirms all 4 error scenarios show correct yellow button + shake + sarcastic tooltip
- User confirms backend logs contain no text content
- User confirms simplified text quality is acceptable across multiple text types
- User confirms rate limit 429 response works with accurate reset time in tooltip
</success_criteria>

<output>
After human verification, create `.planning/phases/02-backend-integration-ai-simplification/02-04-SUMMARY.md`
</output>
