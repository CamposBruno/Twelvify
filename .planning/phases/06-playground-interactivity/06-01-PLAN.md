---
phase: 06-playground-interactivity
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/src/routes/playground.ts
  - backend/src/index.ts
autonomous: true
requirements: [API-01, API-02]

must_haves:
  truths:
    - "POST /api/playground returns a streaming SSE response with the simplified hardcoded sample text"
    - "The endpoint refuses arbitrary text input — only the hardcoded sample is processed"
    - "Rate limit of 60 req/min per client (1 req/sec) is enforced, returning 429 with a friendly error message on breach"
    - "The endpoint is registered in the Express app and responds with correct SSE headers"
  artifacts:
    - path: "backend/src/routes/playground.ts"
      provides: "Dedicated playground route with hardcoded sample, custom rate limiter, SSE streaming"
      min_lines: 50
    - path: "backend/src/index.ts"
      provides: "Registers playgroundRouter alongside existing simplifyRouter"
  key_links:
    - from: "backend/src/routes/playground.ts"
      to: "backend/src/services/aiClient.ts"
      via: "streamSimplification(SAMPLE_TEXT, fixed_options)"
      pattern: "streamSimplification\\(PLAYGROUND_SAMPLE"
    - from: "backend/src/index.ts"
      to: "backend/src/routes/playground.ts"
      via: "app.use(playgroundRouter)"
      pattern: "playgroundRouter"
---

<objective>
Create the dedicated `/api/playground` backend endpoint that powers the landing page live demo.

Purpose: The playground endpoint must be isolated from the main `/api/simplify` route — it uses a hardcoded sample text (no arbitrary user input), has its own stricter rate limiter (60 req/min per IP fingerprint = ~1 req/sec), and streams the simplified result via SSE exactly like the existing simplify route.

Output: `backend/src/routes/playground.ts` (new route) + `backend/src/index.ts` updated to register it.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@backend/src/routes/simplify.ts
@backend/src/middleware/rateLimit.ts
@backend/src/config/constants.ts
@backend/src/services/aiClient.ts
@backend/src/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create /api/playground route with hardcoded sample text and per-client rate limiter</name>
  <files>backend/src/routes/playground.ts</files>
  <action>
Create `backend/src/routes/playground.ts`. Model it closely on `backend/src/routes/simplify.ts` but with these critical differences:

1. **Hardcoded sample text** — define at the top of the file:
   ```ts
   const PLAYGROUND_SAMPLE = "The superfluous utilization of sesquipedalian verbiage inevitably precipitates a profound state of intellectual vertigo for the uninitiated observer.";
   ```
   The route handler ignores any request body. It always calls `streamSimplification` with this constant.

2. **Fixed simplification options** — use `{ tone: 12, depth: 'medium', profession: '' }` (sensible defaults for demo purposes).

3. **Stricter rate limiter** — create a `playgroundRateLimiter` local to this file using `express-rate-limit`. Set `windowMs: 60 * 1000` (1 minute) and `max: 60` (60 requests per minute = ~1 req/sec). Use the same `hashFingerprint` key generator as the existing `rateLimiter`. Handler returns 429 JSON: `{ error: 'rate_limit_exceeded', message: "Whoa, slow down! The AI needs a breather. Try again in a moment.", retryAfterSeconds }`.

4. **SSE streaming** — same pattern as simplify.ts: set `Content-Type: text/event-stream`, `Cache-Control: no-cache`, `Connection: keep-alive`, `X-Accel-Buffering: no`, call `res.flushHeaders()`, iterate `streamSimplification`, write `data: ${JSON.stringify({ chunk })}\n\n` per token, end with `data: ${JSON.stringify({ done: true })}\n\n`.

5. **Method**: `POST /api/playground` — no request body validation (body is ignored).

6. **Error handling** — same as simplify.ts: catch block writes `data: ${JSON.stringify({ error: 'ai_error', message: 'Something went wrong. Give it another go?' })}\n\n` and ends.

7. Export `playgroundRouter` (a `Router()`).

Do NOT accept or use any text from `req.body`. The endpoint is strictly for the hardcoded demo.
  </action>
  <verify>
    Run `cd /Users/brunocampos/Twelvify/backend && npx ts-node --skip-project -e "import('./src/routes/playground.ts').then(m => { console.log(typeof m.playgroundRouter); })" 2>&1 | tail -5`
    The module should load without TypeScript errors (output: "function" or Router type confirmation).
    Also run: `cd /Users/brunocampos/Twelvify/backend && npx tsc --noEmit 2>&1` — must exit with 0 errors.
  </verify>
  <done>
    `backend/src/routes/playground.ts` exists, exports `playgroundRouter`, TypeScript compiles without errors.
    Route handles POST /api/playground with hardcoded sample text, 60 req/min rate limit, SSE streaming.
  </done>
</task>

<task type="auto">
  <name>Task 2: Register playgroundRouter in Express app</name>
  <files>backend/src/index.ts</files>
  <action>
Edit `backend/src/index.ts`:

1. Add import: `import { playgroundRouter } from './routes/playground';`
2. Register after `simplifyRouter`: `app.use(playgroundRouter);`

The final middleware order should be:
```
app.use(healthRouter);
app.use(simplifyRouter);
app.use(playgroundRouter);   // ← add this
app.use(errorHandler);
```

No other changes to index.ts.
  </action>
  <verify>
    Run: `cd /Users/brunocampos/Twelvify/backend && npx tsc --noEmit 2>&1`
    Must exit with 0 TypeScript errors.
    Run: `grep -n "playgroundRouter" /Users/brunocampos/Twelvify/backend/src/index.ts`
    Must show both the import and the `app.use(playgroundRouter)` line.
  </verify>
  <done>
    `backend/src/index.ts` imports and registers `playgroundRouter`. TypeScript compiles clean.
    Starting the backend with `npm run dev` would expose POST /api/playground.
  </done>
</task>

</tasks>

<verification>
- `backend/src/routes/playground.ts` exists and exports `playgroundRouter`
- `backend/src/index.ts` imports and uses `playgroundRouter`
- `cd /Users/brunocampos/Twelvify/backend && npx tsc --noEmit` exits 0
- PLAYGROUND_SAMPLE constant is the exact sample sentence from CONTEXT.md
- No req.body text is ever passed to streamSimplification — only PLAYGROUND_SAMPLE
- Rate limiter uses windowMs: 60*1000, max: 60 (separate from existing rateLimiter)
</verification>

<success_criteria>
- POST /api/playground endpoint exists in the backend codebase
- It always simplifies PLAYGROUND_SAMPLE — never arbitrary user text
- Rate limit is 60/min per client fingerprint (1 req/sec sustained)
- Streaming SSE works identical to /api/simplify
- TypeScript compiles with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-playground-interactivity/06-01-SUMMARY.md`
</output>
